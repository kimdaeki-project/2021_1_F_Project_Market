<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<!-- 바로 쓸 경우가 아니면 mapper는 미리 쓰지 말고 비워주세용 -->

<mapper namespace ="com.mm.market.review.ReviewMapper">
	
	<select id="getListByReviewer" parameterType="ReviewVO" resultType="ReviewVO">
		select * from review where reviewer=#{reviewer}
		order by reviewNum desc
	</select>
	
	<select id="getListByReviewee" parameterType="ReviewVO" resultMap="reviewResult">
		select R.*, P.*, M.*, MF.*
		from review R
		left join product P
		on R.productNum = P.productNum
		left join member M
		on R.reviewer = M.username
		left join memberFile MF
		on R.reviewer = MF.username
		where reviewee=#{reviewee}
		<if test="type != null">
		 and type=#{type}
		</if>
		order by reviewNum desc
	</select>
	
	<resultMap type="ReviewVO" id="reviewResult">
		<id property="reviewNum" column="reviewNum"/>
		<result property="productNum" column="productNum"/>
		<result property="reviewer" column="reviewer"/>
		<result property="reviewee" column="reviewee"/>
		<result property="type" column="type"/>
		<result property="reviewDate" column="reviewDate"/>
		<result property="locationCode" column="locationCode"/>
		<result property="state" column="state"/>
		<result property="manner" column="manner"/>
		<result property="speed" column="speed"/>
		<result property="reviewContent" column="reviewContent"/>
		<association property="product" javaType="ProductVO">
			<id property="productNum" column="productNum"/>
			<result property="productName" column="productName"/>
		</association>
		<association property="reviewerVO" javaType="MemberVO">
			<id property="username" column="username"/>
			<result property="name" column="name"/>
			<result property="code" column="code"/>
		</association>
		<association property="reviewerFile" javaType="MemberFileVO">
			<id property="username" column="username"/>
			<result property="fileName" column="fileName"/>
		</association>
	</resultMap>
	
	<select id="getSelect" parameterType="ReviewVO" resultType="ReviewVO">
		select * from review where productNum=#{productNum}
		<if test="reviewer != null">
			and reviewer=#{reviewer}
		</if>
	</select>
	
	<insert id="setInsert" parameterType="ReviewVO">
		insert into review (productNum, reviewer, reviewee, type, locationCode, state, manner, speed, reviewContent)
		values (#{productNum}, #{reviewer}, #{reviewee}, #{type}, #{locationCode}, #{state}, #{manner}, #{speed}, #{reviewContent})
	</insert>
</mapper>